require('dotenv').config();
const cors = require('cors');
const express = require('express');
const connectDB = require("./services/db.js");

// Create server function (used by frontend if imported)
function createServer() {
    const app = express();

    app.use(cors({
        origin: "http://localhost:5173",
        credentials: true,
    }));


    app.use(express.json());
    app.use(express.urlencoded({ extended: false }));

    // API routes
    app.use("/api/sales", require("./routes/saleRoutes"));

    return app;
}

module.exports = { createServer };

// ----------------------------------------------------
// If index.js is run directly â†’ start full backend
// ----------------------------------------------------
if (require.main === module) {
    (async () => {
        await connectDB();

        const app = createServer();
        const PORT = process.env.PORT || 5000;

        app.listen(PORT, () => {
            console.log(`Server listening on port ${PORT}`);
        });
    })();
}
